---
title: "_Лабораторна робота № 3_. Основи вибіркового методу"
author: "&copy; [Худієнко A. A.]"
date: "`r Sys.Date()`"
output:
#   pdf_document:
#     highlight: tango
#     toc: yes
#   word_document:
#     highlight: tango
#     toc: yes
# always_allow_html: true
  html_notebook:
    # citation_package: natbib
    toc: yes # Оглавление
    toc_float: true
    highlight: tango # Цвет подсветки кода
fontsize: 12pt # размер шрифта
header-includes:
 \usepackage[T2A]{fontenc}
 \usepackage[utf8]{inputenc}
 \usepackage[russian]{babel}
editor_options: 
  chunk_output_type: console
---


__Мета:__ _засвоїти основи статистичного оцінювання характеристик випадкової величини на основі вибіркового підходу засобами мови програмування R; набути навичок роботи у середовищі RStudio із застосуванням концепції "грамотного програмування" із застосуванням пакету R Markdown_. 


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE, include=FALSE}
packages <- c("beeswarm", "moments", "Hmisc")
# install.packages(packages)
lapply(packages, library, character.only=TRUE)
```
=

## Короткі теоретичні положення{#teor}

__Вибірковий метод__ (method of sampling) -- статистичний метод дослідження загальних властивостей сукупності будь-яких об'єктів на основі вивчення властивостей лише частини цих об'єктів. Сукупність досліджуваних об'єктів, що цікавлять дослідника, називається __генеральною сукупністю (statistical population)__. А частина об'єктів, що підлягають вивченню, називають __вибірковою сукупністю__ або __вибіркою (sample)__.  

_Визначення_. __Вибіркою__ об’єму $n$ називається випадковий вектор $X=(x_1, x_2,\dots,x_n)$, де  $x_1, x_2,\dots,x_n$ -- незалежні й однаково розподілені випадкові величини з функцією розподілення $F(x)$.  

Простими словами, сенс і сила вибіркового методу полягає в тому, що можна взяти __не всі__ (генеральну сукупність), а тільки __декілька__ (вибірку з $n$ значень) випадкових значень певної випадкової величини $X$, що нас цікавить (зараплату по країні, долю людей, що проголусували за того, чи іншого кандидата, врожайність пшениці в регіоні тощо), і можна з достатньою точністю зробити висновки стосовно всієї генеральної скупності. 

Таким чином, суть вибіркового методу як технології полягає в тому, щоби знизити розмірність вибірки і виразити закономірності у поведінці випадкової величини у вигляді невеликої кількості __числових__ та __функціонаьних характеристик__.  

Вся класична теорія вимірювань та метрологія ґрунтується на парадигмі вибіркового методу. Нормування складових похибок вимірювань полягає у застосуванні вибіркового методу для оцінки низки статистичних характеристик похибки вимірювання як випадкової величини.

Етапи вибіркового методу представлені на рис. 1.


![_Рис. 1. Етапи вибіркового методу_](image/SampleMethod.png)


## Короткі практичні зауваження

### Створення RMarkdown-документу

1. Завантажуємо [RStudio](https://www.rstudio.com/products/rstudio/download/).

2. Створюємо RMarkdown-документ у форматі [R Notebook](http://rmarkdown.rstudio.com/r_notebooks.html), вибравши відповідний пункт [меню](https://prnt.sc/gkpes4).


### Генерація електронного документу

Генерація електронного документу здійснюється натисканням комбінації _Ctrl+Shift+K_.


## Загальна постановка задачі{#task}

Випадкова величина (результат вимірювання) $X$ має розподіл  $F(x, \Theta)$, вектор параметрів $\Theta=(\theta_1, ...,\theta_s)$  якого відомий (див. варіанти завдань). Згенерувати дві вибірки  випадкової величини $X=(x_1,...,x_n)$ за допомогою відповідного генератору псевдовипадкових чисел:  відповідно обсягів $n=100$  та $n=10000$, що мають розподіл  $F(x, \Theta)$, обчислити і дослідити оцінку вектора параметрів розподілу $\tilde{\Theta}=\tilde{\Theta}(x_1,...,x_n)\approx \Theta$  та інші статистичні характеристики, зробити порівняльний аналіз оцінених характеристик між собою і з теоретичними характеристиками (див. детально наступний пункт). 

## Приклад виконання лабораторної роботи

### 1. Постановка задачі



```{r, include=FALSE}

a <- 3
s <- 5
n1 <- 150
n2 <- 110000
n <- n1
```



Випадкова величина $X$ має нормальний закон розподілу: $X\sim F(a,\sigma^2)$, тобто $X\sim N(a,\sigma^2)$, вектор параметрів $\Theta=(a,\sigma^2)$  якого відомий:  $(a,\sigma^2)=($ `r a` $,$ `r s` $)$ . Тобто, $a=$ `r a`, $\sigma^2=$ `r s`. Згенерувати дві вибірки  випадкової величини $X$ за допомогою відповідного генератору псевдовипадкових чисел: $(x_1,x_2,...,x_n)$  відповідно обсягів $n=100$ та $n=1000$, що мають розподіл  $X\sim N($ `r a`, `r s^2` $)$, обчислити і дослідити оцінки параметрів розподілу $\tilde{a}=\tilde{a}(x_1,x_2,...,x_n)\approx a$,   $\tilde{\sigma}=\tilde{\sigma}(x_1,x_2,...,x_n)=\sigma$ та інші статистичні характеристики, зробити порівняльний аналіз оцінених характеристик між собою і з теоретичними характеристиками. Для цього необхідно:

1. Побудувати статистичний розподіл у вигляді інтервальної таблиці відносних частот.

1. Побудувати гістограму, теоретичну $f(x,a,\sigma)$ та емпіричну $f^*(x,\tilde{a},\tilde{\sigma})$ функції щільності на одному графіку.

1. Побудувати графіки теоретичної $F(x,a,\sigma)$ та емпіричної $F^*(x,\tilde{a},\tilde{\sigma})$ функції розподілу.

1. Побудувати п'ятиквантильний графік (boxplot) "ящик з вусами".

1. Обчислити точкові незміщені і конзістентні оцінки вектору параметрів розподілу  $(a,\sigma^2)$, математичного сподівання $m(x)$, дисперсії $D(x)$, СКВ $\sigma(x)$, центральних теоретичних моментів $3$-го $\mu_3$   і $4$-ого  $\mu_4$ порядків, асиметрії $A_s$ та ексцесу $E_k$:

  - написавши власну користувацьку функцію;
  
  - за допомогою вбудованих засобів R.  
6. Дані звести у таблицю:


:Таблиця 1 -- __Теоретичні та емпіричні (вибіркові) числові характеристики випадкової величини__


Назва числової характеристики | теоретичне значення | Вибіркове значення, $n=150$ | Вибіркове значення, $n=110000$ |
--------|----|------|---------
$a$|$a$| $\tilde a$ | $\tilde a$
$\sigma$|$\sigma$|$\tilde{\sigma}$|${\tilde{\sigma}}$
Математичне сподівання|$m(x)$|$\tilde{m}(x)$|$\tilde{m}(x)$
Дисперсія|$D(x)$|$\tilde{D}(x)$|$\tilde{D}(x)$
Виправлена дисперсія||$\tilde{\tilde{D}}(x)$|$\tilde{\tilde{D}}(x)$
СКВ|$\sigma(x)$|$\tilde{\sigma}(x)$|$\tilde{\sigma}(x)$
Виправлене СКВ||$\tilde{\tilde\sigma}(x)$|$\tilde{\tilde\sigma}(x)$
Центральний момент $3$-го порядку|$\mu_3$|$\tilde{\mu}_3$|$\tilde{\mu}_3$
Центральний момент $4$-го порядку|$\mu_4$|$\tilde{\mu}_4$|$\tilde{\mu}_4$
Асимерія|$A_s$|$\tilde{A}_s$|$\tilde{A}_s$
Ексцес|$E_k$|$\tilde{E}_k$|$\tilde{E}_k$


### 2. Виконання роботи (основні моменти)



Генеруємо вибірку з нормального розподілу з параметрами $a=$ `r a`, $\sigma=$ `r s` об'єму $n=$ `r n`:

```{r, echo=TRUE, message=FALSE, warning=FALSE}
set.seed(0) # фіксація параметрів генератора псевдовипадкових чисел 
X1 <- rnorm(n1, a, s) # генератор нормального розподілу
X2 <- rnorm(n2, a, s) # генератор нормального розподілу
X <- X1 # Присвоюємо X1 (вибірка обсягом n1) ім'я X для подальшого аналізу

cat("\n", "Параметри вибірки:", "\n", "a = ", a, "\n" , "s = ", s, "\n" , "n = ", n, "\n")
cat("Перші елементи вибірки:", head(X))
cat("Останні елементи вибірки:", tail(X))

# qnorm(0.95+0.025, mean = 0, sd = 1, lower.tail = TRUE, log.p = FALSE)
```


Будуємо варіаційний ряд.

```{r}
SortX <- sort(X) # варіаційний ряд
plot(SortX, col=4)
title("Варіаційний ряд - доля значень")
# dev.off()
```

Будуємо інтервальний статистичний розподіл і гістограму частот.

```{r}
1 + 1.332 * log(n)

# За замовчанням - "Sturges", заголовок відсутній
table(cut(X, nclass.Sturges(X))) # Вивід інтревального варіаційного ряду
hist(X, breaks=nclass.Sturges(X),
     col="Lightblue",
     main="Гістограма частот") # Кількість карманів за Стерджессом
```

Гістограма відносних частот.

```{r}
hist(X,
     freq = FALSE,
     col = "Lightblue",
     main = "Гістограма відносних частот")
curve(dnorm(x, a, s), col = 2, lty = 2, lwd = 2, add = TRUE) # теоретична крива щільності розподілу
curve(dnorm(x, mean(X), sd(X)), col = 3, lty = 2, lwd = 2, add = TRUE) # емпірична крива щільності розподілу
```

Сумарні статистики.

Вивід сумарних статистик.

```{r}
summary(X)
```
Альтернативний варіант за допомогою спеціальних функцій:

```{r}
mean(X)
sd(X)
IQR(X)
kurtosis(X)
skewness(X)
```

Можна так:

:Таблиця 2 -- __Числові характеристики вибірки__

Характеристика | Значення
-----|-----
$\tilde{m}(x)$| `r mean(X)`
$\tilde{\tilde{\sigma}}(x)$| `r sd(X)`
$\tilde{R}$| `r IQR(X)`


Функція `describe()` з пакету `Hmisc` надає можливість вивести цілу низку сумарних оцінок характеристик вибірки:
```{r}
describe(X)

```

А можна написати власну функцію.

```{r}

my_summary <- function(X, ...) {
  cat("\n", "Оцінки статистичних характеристик вибірки:", "\n", 
      "вибіркове математичне сподівання, m = ", mean(X), "\n",
      "Медіана, Ме = ", median(X) , "\n",
      "вибіркова дисперсія, s^2 = ", var(X), "\n" ,
      "вибіркове СКВ, s = ", sd(X), "\n" ,
      "Розмах, R = ", max(X) - min(X), "\n" ,
      "Інтерквартільний розмах, IQR = ", IQR(X), "\n",
      "Ексцес, Ek = ", kurtosis(X), "\n",
      "Асиметрія, As= ", skewness(X), "\n"
    )
}

my_summary(X,  na.rm=FALSE)


```



Ще один варіант представлення теоретичного і емпіричного розподілів.

```{r}
plot(density(X, adjust=2), main="X", col=4)
rug(X, col=2) # Виділення місць точками з наібільшою щільністю значень
```

Емпірична функція росподілу F(x).

F(x) з числом інтервалів за Стерджессом.

```{r}
# Fn <- ecdf(table(cut(X, nclass.Sturges(X))))

Fn <- ecdf(X)


## luxury plot
plot(Fn,
     verticals = TRUE,
     col.points = "blue",
     col.hor = "red",
     col.vert = "bisque",
     main = "Емпірична функція розподілу")
```

Побудова боксплотів (ящиків з вусами).

```{r}
# Ще одна альтернатива - "графік-вулик"
boxplot(X, main="box-plot X")  # вивід боксплоту
beeswarm(X, col=2, add=TRUE) # ДОДАВАННЯ "рою" з ефектом jutter
```

На практиці оптимальним може бути компактний варіант виводу основних графіків вибіркових характеристик. Наприклад, такий.

```{r}
op <- par(mfrow = c(2,2))
          
# Гістограма відносних частот 
hist(X,
     freq = FALSE,
     col = "Lightgray",
     main="Histogram",
     border=4)

curve(dnorm(x, a, s),
      col = 2,
      lty = 2,
      lwd = 2,
      add = TRUE) # крива щільності

plot(Fn,
     main = "Quantile Plot",
     verticals = TRUE,
     col.points = "blue",
     col.hor = "red",
     col.vert = "bisque",
     xlab = "X",
     ylab = "Fn(x)")

boxplot(X,
        main = "Box-and-Wisker Plot",
        col = "Lightgray",
        border = 4,
        xlab = "X",
        ylab = "",
        horizontal = TRUE)  # боксплот

beeswarm(X,
         col = 2,
         add = TRUE,
         horizontal = TRUE) # ДОДАВАННЯ "рою" з ефектом jutter

plot(density(X, adjust=2),
     main = "density trace",
     xlab = "X",
     ylab = "Dencity",
     col="blue")

rug(X,
    col=2,
    main="fn(x)") # Виділення точками місць з найбільшою щільністю значень

par(op) #Повертаємо параметри за замовчанням  

?rnorm()
```

__Результати моделювання зводимо у таблицю.__

:Таблиця 3 -- __Теоретичні та емпіричні (вибіркові) числові характеристики випадкової величини__


Назва числової характеристики | теоретичне значення | Вибіркове значення, $n=$ `r n` | Вибіркове значення, $n=1000$ |
--------|----|------|---------
$a$|`r a`| `r mean(X)` | $\tilde a$
$\sigma$|`r s`|`r sd(X)`|${\tilde{\sigma}}$
Математичне сподівання|`r a`|`r mean(X)`|$\tilde{m}(x)$
Дисперсія|`r s^2`|`r var(X)`|$\tilde{D}(x)$
Виправлена дисперсія||`r var(X)*n/(n-1)`|$\tilde{\tilde{D}}(x)$
СКВ|`r s`|`r sd(X)`|$\tilde{\sigma}(x)$
Виправлене СКВ||`r sqrt(var(X)*n/(n-1))`|$\tilde{\tilde\sigma}(x)$
Центральний момент $3$-го порядку|$\mu_3$|$\tilde{\mu}_3$|$\tilde{\mu}_3$
Центральний момент $4$-го порядку|$\mu_4$|$\tilde{\mu}_4$|$\tilde{\mu}_4$
Асимерія|$A_s$|$\tilde{A}_s$|$\tilde{A}_s$
Ексцес|$E_k$|$\tilde{E}_k$|$\tilde{E}_k$
 
## Порядок виконання лабораторної роботи.

1. Ознайомитися з [короткими теоретичними положеннями](#teor) та [матеріалами методички для практичних занять](doc/ПЗ 1-2021.docx). Детальні теоретичні аспекти та __варіанти індивідуальних завдань видаються індивідуально кожному__.  
1. Вибрати варіант індивідуального завдання.  
1. Створити проект, в основі якого лежить документ RMarkdown у форматі RNotebook, для розв'язання [задачі](#task) згідно з отриманим варіантом. __За основу взяти RNotebook документ цієї методички__. Проект має містити наступні розділи (приблизний перелік задач):
  i) Постановку задачі з детальним описом заданого розподілу і його параметрів.
  i) Розв'язок задачі з необхідними коментарями.
  i) Висновки.
  i) Перелік посилань на основі bib-файлу.
  


## References

